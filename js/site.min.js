/*! FC2 Blog Designer's Link - v0.1.0 - 2012-09-09
* Copyright (c) 2012 moi; Licensed MIT, GPL */
(function(){var Pagination,UI;UI=function(){function UI(a){var b,c;this.opt=$.extend(def,a),b=this,getData(this.opt.src).then(function(a){return b.site=a.site,b.totalPage=Math.ceil(a.site.length/b.opt.hits),b.page=getPage.apply(b),render(b.opt.target,b.opt.template,load.apply(b,[b.page])),$(".pagination").append(getPagination.apply(b))},function(){}),c=$(this.opt.target).masonry({itemSelector:".box",columnWidth:300,gutterWidth:20}).on("click",".twitter",function(a){return a.preventDefault(),a.stopPropagation(),window.open($(this).data("href"))}),infiniteScroll.apply(this),$(window).hashchange(function(){return b.opt.hits=20,b.page=getPage.apply(b),c.empty().masonry("reload"),render(b.opt.target,b.opt.template,load.apply(b,[b.page])),$(".pagination").empty().append(getPagination.apply(b))})}var def,getData,getPage,getPagination,infiniteScroll,load,render;return def={hits:20,template:"#template-list",target:"#list",src:"js/site.json"},getPagination=function(){return(new Pagination).get({total:this.totalPage,current:this.page})},getPage=function(){var a;return a=location.hash.split("/"),a.length<2?1:a[1]==="all"?(this.opt.hits=this.site.length,1):a[1]-0},getData=function(src){var dfd;return dfd=new $.Deferred,$.ajax({url:src+"?callback=?",dataType:"jsonp",complete:function(data){var res;return res=data.responseText,dfd.resolve(JSON?JSON.parse(res):eval(res))},fail:function(){return dfd.reject()}}),dfd.promise()},load=function(a){var b,c,d;return c=this.opt.hits,b=(a-1)*c,d=b+c,d>=this.site.length&&(d=this.site.length-1),this.site.slice(b,d)},render=function(a,b,c){return render.target=render.target||$(a),c=$($(b).render(c)),render.target.append(c),c.imagesLoaded(function(){return render.target.masonry("appended",c)})},infiniteScroll=function(){var a,b;return b=this,$(window).on("scroll",function(){var a,b,c;c=$(window),a=$(document).height(),b=c.height()+c.scrollTop();if((a-b)/a<=.1)return c.trigger("bottom")}).on("bottom",a=function(){a.i=a.i||0;if(a.i)return;return a.i=1,setTimeout(function(){return a.i=0},1e3),render(b.opt.target,b.opt.template,load.apply(b,[++b.page]))})},UI}(),Pagination=function(){function b(){}var a;return a={range:9,prev:"«",next:"»"},b.prototype.get=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;this.opt=$.extend(a,b),o=this.opt.total,l=this.opt.range,c=this.opt.current,o<1&&(o=1),c<1&&(c=1),l>o&&(l=o),e=Math.ceil(l/2),c-e<0?(i=1,h=l):c+e>=o?(i=o-l+1,h=o):(i=c-e+1,h=c+e),p=$("<ul/>");for(f=q=i;i<=h?q<=h:q>=h;f=i<=h?++q:--q)g=$("<li>").appendTo(p),f===c&&g.addClass("active"),$("<a>").attr("href","#!/"+f).text(f).appendTo(g);return d=$('<li class="disabled"><a href="#">...</a></li>'),i>1&&(d.prependTo(p),n=$("<li>").prependTo(p),$("<a>").attr({href:"#!/1"}).text("1").appendTo(n)),h<o&&(d.clone().appendTo(p),m=$("<li>").appendTo(p),$("<a>").attr("href","#!/"+o).text(o).appendTo(m)),k=$('<li class="prev" />'),j=$('<li class="next" />'),$("<a />").attr("href","#!/"+(c-1)).text(this.opt.prev).appendTo(k),$("<a />").attr("href","#!/"+(c+1)).text(this.opt.next).appendTo(j),c<=1&&k.addClass("disabled"),c>=o&&j.addClass("disabled"),p.prepend(k).append(j),p},b}(),$(function(){return new UI})}).call(this);